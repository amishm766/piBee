<form [formGroup]="changePasswordForm">
  <div class="form-group">
    <h3 class="form-heading mt-5">Change Password</h3>
    <div class="form-group">
      <label class="form-label">Username :</label>
      <input
        type="text"
        class="form-control"
        name="username"
        [value]="loggedInUser.username"
        readonly
      />
    </div>
    <div class="form-group">
      <label class="form-label required">Old Password</label>
      <div class="row" style="margin: 0px;">
        <input
          autofocus
          type="password"
          class="form-control"
          formControlName="oldPassword"
          [ngClass]="{
            'is-invalid': isInValid(value('oldPassword')),
            'is-valid': isValid(value('oldPassword'))
          }"
        />

        <small
          *ngIf="
            value('oldPassword').touched &&
            value('oldPassword').errors?.required
          "
          class="alert alert-danger alert-icon"
          ><span style="margin-left: 20px;">{{
            "Password is Mandatory."
          }}</span></small
        >
      </div>
    </div>

    <div class="form-group">
      <label class="form-label required">New Password</label>
      <div class="row" style="margin: 0px;">
        <input
          type="password"
          class="form-control"
          formControlName="password"
          [ngClass]="{
            'is-invalid': isInValid(value('password')),
            'is-valid': isValid(value('password'))
          }"
        />

        <div class="valid-feedback">
          Password is in valid format.
        </div>

        <small
          *ngIf="value('password').touched && value('password').errors?.pattern"
          class="alert alert-danger alert-icon"
          ><span style="margin-left: 20px;">{{
            "Enter password in valid format."
          }}</span></small
        >

        <small
          *ngIf="
            value('password').touched && value('password').errors?.required
          "
          class="alert alert-danger alert-icon"
          ><span style="margin-left: 20px;">{{
            "Password is Mandatory."
          }}</span></small
        >
      </div>

      <small
        *ngIf="value('password').errors?.required || value('password').dirty"
        style="color: grey;"
      >
        <ng-template #initialText>
          <span *ngIf="!isValid(value('password'))">{{
            "*Need 8 characters including a number,an Uppercase and lowercase letter."
          }}</span>
        </ng-template>
        <div
          *ngIf="
            value('password').dirty &&
              value('password').errors &&
              !value('password').errors?.required;
            else initialText
          "
        >
          *Need
          <span *ngIf="value('password').errors?.minlength">
            {{
              value("password").errors?.minlength.requiredLength -
                value("password").errors?.minlength.actualLength
            }}
            <span
              *ngIf="
                value('password').errors?.minlength.requiredLength -
                  value('password').errors?.minlength.actualLength >
                1
              "
              >{{ "characters, " }}</span
            >
            <span
              *ngIf="
                value('password').errors?.minlength.requiredLength -
                  value('password').errors?.minlength.actualLength <=
                1
              "
              >{{ "character, " }}</span
            >
          </span>
          <span *ngIf="value('password').errors?.hasNumber">{{
            "a number, "
          }}</span>
          <span *ngIf="value('password').errors?.hasCapitalCase">{{
            "an Uppercase "
          }}</span>
          <span *ngIf="value('password').errors?.hasSmallCase"
            >{{ "and lowercase" }}
          </span>
          <span
            *ngIf="
              value('password').errors?.hasSmallCase ||
              value('password').errors?.hasCapitalCase
            "
            >{{ " letter." }}</span
          >
        </div>
      </small>
    </div>

    <button
      (click)="confirmUser()"
      type="submit"
      class="btn"
      [disabled]="changePasswordForm.invalid"
      [ngClass]="{
        'form-valid': !changePasswordForm.invalid,
        'form-invalid': changePasswordForm.invalid
      }"
    >
      Change
    </button>
  </div>
</form>
